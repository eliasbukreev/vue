<script setup lang="ts">
import WebApp from '@twa-dev/sdk'

WebApp.ready()

async function submit(payload: Record<string, any>) {
  try {
    //–ê–Ω–∏–º–∞—Ü–∏—è + –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    await new Promise(r => setTimeout(r, 500))

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram
    WebApp.sendData(JSON.stringify(payload))

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    alert('–°–ø–∞—Å–∏–±–æ! –í–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã üéâ')

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
    WebApp.close()
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error)
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')
  }
}

</script>

<template>
  <div class="bg-white rounded-xl shadow-xl p-8 mx-auto my-16 max-w-[450px]">
    <FormKit
      type="form"
      #default="{ value }"
      @submit="submit"
    >
    <div class="my-8">
      <h1 class="text-xl font-bold mb-2">–í–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º –∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏: </h1>
      <span class="text-gray-500 text-sm">C–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∏ –≤–∞–∂–Ω—ã–µ –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å–µ–∫—Ü–∏–∏ </span>
    </div>
    <FormKit
      type="textarea"
      name="question_1"
      label="–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ò–ë."
      placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å"
      :help="`${value!.question_1 ? ((value!.question_1) as string).length : 0} / 120`"
      validation="length:0,120"
      validation-visibility="live"
      :validation-messages="{
        length: '–í–æ–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 120 —Å–∏–º–≤–æ–ª–æ–≤',
      }"
      help-class="text-right text-gray-500 text-sm"
    />
    <FormKit
      type="textarea"
      name="question_2"
      label="–ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."
      placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å"
      :help="`${value!.question_2 ? ((value!.question_2) as string).length : 0} / 120`"
      validation="length:0,120"
      validation-visibility="live"
      :validation-messages="{
        length: '–í–æ–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 120 —Å–∏–º–≤–æ–ª–æ–≤',
      }"
      help-class="text-right text-gray-500 text-sm"
    />
    <FormKit
      type="textarea"
      name="question_3"
      label="–ò–º–ø–æ—Ä—Ç–æ–≤—ã–∑–æ–≤. C—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –¥–ª—è –ò–ë."
      placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å"
      :help="`${value!.question_3 ? ((value!.question_3) as string).length : 0} / 120`"
      validation="length:0,120"
      validation-visibility="live"
      :validation-messages="{
        length: '–í–æ–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 120 —Å–∏–º–≤–æ–ª–æ–≤',
      }"
      help-class="text-right text-gray-500 text-sm"
    />
    </FormKit>
  </div>
</template>
